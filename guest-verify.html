
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 页面编号: A-01 /verify -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>身份验证 - 酒店客服系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <style>
        :root {
            --primary: #0F62FE;
            --secondary: #FF6B00;
            --bg: #F5F7FA;
        }
    </style>
</head>
<body class="bg-gray-50 font-[system-ui]" x-data="verifyApp()">
    <div class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md">
            <!-- 语言选择 -->
            <div class="flex justify-end mb-4">
                <select x-model="currentLanguage" @change="changeLanguage" 
                        class="px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        data-testid="language-select">
                    <option value="zh">中文</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="ko">한국어</option>
                </select>
            </div>

            <!-- Logo和房号 -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="uil uil-building text-white text-3xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800" x-text="texts.welcome"></h1>
                <p class="text-gray-600 mt-2" x-text="texts.roomNumber + roomNumber"></p>
            </div>

            <!-- 验证表单 -->
            <form @submit.prevent="handleVerify" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" x-text="texts.verifyLabel">
                    </label>
                    <input 
                        type="text" 
                        x-model="verifyCode"
                        data-testid="verify-input"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        :placeholder="texts.verifyPlaceholder"
                        required
                    >
                </div>

                <!-- 错误提示 -->
                <div x-show="errorMessage" x-transition class="bg-red-50 border border-red-200 rounded-lg p-3">
                    <p class="text-red-600 text-sm" x-text="errorMessage"></p>
                </div>

                <!-- 确认按钮 -->
                <button 
                    type="submit"
                    data-testid="verify-submit"
                    :disabled="loading"
                    class="w-full py-3 px-4 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                >
                    <span x-show="!loading" x-text="texts.verifyButton"></span>
                    <span x-show="loading" class="flex items-center justify-center">
                        <i class="uil uil-spinner-alt animate-spin mr-2"></i>
                        <span x-text="texts.verifying"></span>
                    </span>
                </button>
            </form>

            <!-- 快捷服务菜单 -->
            <div class="mt-8 border-t pt-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4" x-text="texts.quickServices"></h3>
                <div class="grid grid-cols-2 gap-3">
                    <template x-for="service in quickServices" :key="service.id">
                        <button 
                            @click="requestService(service)"
                            class="flex flex-col items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
                            :data-testid="'service-' + service.id"
                        >
                            <i :class="service.icon" class="text-2xl text-blue-600 mb-2"></i>
                            <span class="text-sm font-medium text-gray-700" x-text="service.name"></span>
                        </button>
                    </template>
                </div>
                <p class="text-xs text-gray-500 mt-3 text-center" x-text="texts.serviceNote"></p>
            </div>

            <!-- 帮助信息 -->
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500" x-text="texts.helpText">
                </p>
                <a href="tel:021-12345678" class="text-blue-600 hover:underline">021-12345678</a>
            </div>
        </div>
    </div>

    <!-- 服务请求模态框 -->
    <div x-show="showServiceModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-semibold mb-4" x-text="texts.serviceRequest"></h3>
            <template x-if="selectedService">
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <i :class="selectedService.icon" class="text-2xl text-blue-600"></i>
                        <div>
                            <h4 class="font-medium" x-text="selectedService.name"></h4>
                            <p class="text-sm text-gray-600" x-text="selectedService.description"></p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2" x-text="texts.additionalNotes"></label>
                        <textarea 
                            x-model="serviceNote"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            rows="3"
                            :placeholder="texts.serviceNotePlaceholder"
                        ></textarea>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <p class="text-blue-800 text-sm" x-text="texts.serviceInfo"></p>
                    </div>
                </div>
            </template>
            
            <div class="flex justify-end space-x-2 mt-6">
                <button 
                    class="px-4 py-2 text-gray-600 hover:text-gray-800"
                    @click="showServiceModal = false; selectedService = null; serviceNote = ''"
                    x-text="texts.cancel"
                >
                </button>
                <button 
                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                    @click="confirmService"
                    data-testid="confirm-service"
                    x-text="texts.confirm"
                >
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mock数据
        const MOCK = {
            roomNumber: '1208',
            validCodes: ['张三', '1234', '李四', '5678']
        };

        // 多语言配置
        const LANGUAGES = {
            zh: {
                welcome: '欢迎入住',
                roomNumber: '房间号: ',
                verifyLabel: '请输入您的姓氏后2位或手机号后4位',
                verifyPlaceholder: '例如：张三 或 1234',
                verifyButton: '确认验证',
                verifying: '验证中...',
                quickServices: '快捷服务',
                serviceNote: '选择服务后将直接联系酒店工作人员',
                helpText: '需要帮助？请联系前台 ',
                serviceRequest: '服务请求',
                additionalNotes: '备注说明',
                serviceNotePlaceholder: '请输入具体需求或特殊要求...',
                serviceInfo: '您的服务请求将立即发送给酒店工作人员，我们会尽快为您安排。',
                cancel: '取消',
                confirm: '确认',
                verifyFailed: '验证失败，请检查输入信息是否正确',
                networkError: '网络错误，请稍后重试',
                verifySuccess: '验证成功！即将跳转到聊天页面',
                serviceConfirmed: '服务请求已提交，工作人员会尽快联系您'
            },
            en: {
                welcome: 'Welcome',
                roomNumber: 'Room: ',
                verifyLabel: 'Please enter the last 2 digits of your surname or last 4 digits of your phone',
                verifyPlaceholder: 'e.g., Smith or 1234',
                verifyButton: 'Verify',
                verifying: 'Verifying...',
                quickServices: 'Quick Services',
                serviceNote: 'Hotel staff will be contacted directly after selecting service',
                helpText: 'Need help? Please contact front desk ',
                serviceRequest: 'Service Request',
                additionalNotes: 'Additional Notes',
                serviceNotePlaceholder: 'Please enter specific requirements or special requests...',
                serviceInfo: 'Your service request will be sent to hotel staff immediately, and we will arrange it as soon as possible.',
                cancel: 'Cancel',
                confirm: 'Confirm',
                verifyFailed: 'Verification failed, please check your input',
                networkError: 'Network error, please try again later',
                verifySuccess: 'Verification successful! Redirecting to chat page',
                serviceConfirmed: 'Service request submitted, staff will contact you soon'
            },
            ja: {
                welcome: 'ようこそ',
                roomNumber: '部屋番号: ',
                verifyLabel: '姓の最後2文字または電話番号の最後4桁を入力してください',
                verifyPlaceholder: '例：田中 または 1234',
                verifyButton: '確認',
                verifying: '確認中...',
                quickServices: 'クイックサービス',
                serviceNote: 'サービス選択後、ホテルスタッフに直接連絡いたします',
                helpText: 'ヘルプが必要ですか？フロントデスクまでお電話ください ',
                serviceRequest: 'サービスリクエスト',
                additionalNotes: '備考',
                serviceNotePlaceholder: '具体的な要求や特別な要望を入力してください...',
                serviceInfo: 'サービスリクエストは即座にホテルスタッフに送信され、可能な限り迅速に手配いたします。',
                cancel: 'キャンセル',
                confirm: '確認',
                verifyFailed: '確認に失敗しました。入力情報を確認してください',
                networkError: 'ネットワークエラーです。後でもう一度お試しください',
                verifySuccess: '確認成功！チャットページにリダイレクトします',
                serviceConfirmed: 'サービスリクエストが送信されました。スタッフがすぐに連絡いたします'
            },
            ko: {
                welcome: '환영합니다',
                roomNumber: '객실 번호: ',
                verifyLabel: '성씨의 마지막 2자리 또는 전화번호의 마지막 4자리를 입력하세요',
                verifyPlaceholder: '예: 김민수 또는 1234',
                verifyButton: '확인',
                verifying: '확인 중...',
                quickServices: '빠른 서비스',
                serviceNote: '서비스 선택 후 호텔 직원에게 직접 연락드립니다',
                helpText: '도움이 필요하세요? 프론트 데스크로 연락하세요 ',
                serviceRequest: '서비스 요청',
                additionalNotes: '추가 사항',
                serviceNotePlaceholder: '구체적인 요구사항이나 특별한 요청사항을 입력하세요...',
                serviceInfo: '서비스 요청이 즉시 호텔 직원에게 전송되며, 가능한 한 빠르게 안내해드리겠습니다.',
                cancel: '취소',
                confirm: '확인',
                verifyFailed: '확인에 실패했습니다. 입력 정보를 확인하세요',
                networkError: '네트워크 오류입니다. 나중에 다시 시도하세요',
                verifySuccess: '확인 성공! 채팅 페이지로 이동합니다',
                serviceConfirmed: '서비스 요청이 제출되었습니다. 직원이 곧 연락드리겠습니다'
            }
        };

        function verifyApp() {
            return {
                roomNumber: MOCK.roomNumber,
                verifyCode: '',
                errorMessage: '',
                loading: false,
                currentLanguage: 'zh',
                showServiceModal: false,
                selectedService: null,
                serviceNote: '',

                get texts() {
                    return LANGUAGES[this.currentLanguage] || LANGUAGES.zh;
                },

                get quickServices() {
                    const services = {
                        zh: [
                            { id: 1, name: '客房清洁', icon: 'uil uil-cleaning-services', description: '安排客房清洁服务' },
                            { id: 2, name: '送餐服务', icon: 'uil uil-utensils', description: '客房送餐服务' },
                            { id: 3, name: '洗衣服务', icon: 'uil uil-shirt', description: '衣物清洗服务' },
                            { id: 4, name: '设施维修', icon: 'uil uil-wrench', description: '房间设施维修' },
                            { id: 5, name: '额外用品', icon: 'uil uil-box', description: '毛巾、拖鞋等用品' },
                            { id: 6, name: '其他服务', icon: 'uil uil-question-circle', description: '其他服务需求' }
                        ],
                        en: [
                            { id: 1, name: 'Housekeeping', icon: 'uil uil-cleaning-services', description: 'Room cleaning service' },
                            { id: 2, name: 'Room Service', icon: 'uil uil-utensils', description: 'Food delivery service' },
                            { id: 3, name: 'Laundry', icon: 'uil uil-shirt', description: 'Laundry service' },
                            { id: 4, name: 'Maintenance', icon: 'uil uil-wrench', description: 'Room facility repair' },
                            { id: 5, name: 'Amenities', icon: 'uil uil-box', description: 'Towels, slippers, etc.' },
                            { id: 6, name: 'Other Services', icon: 'uil uil-question-circle', description: 'Other service needs' }
                        ],
                        ja: [
                            { id: 1, name: 'ハウスキーピング', icon: 'uil uil-cleaning-services', description: '客室清掃サービス' },
                            { id: 2, name: 'ルームサービス', icon: 'uil uil-utensils', description: '客室内食事サービス' },
                            { id: 3, name: 'ランドリー', icon: 'uil uil-shirt', description: '洗濯サービス' },
                            { id: 4, name: 'メンテナンス', icon: 'uil uil-wrench', description: '客室設備修理' },
                            { id: 5, name: 'アメニティ', icon: 'uil uil-box', description: 'タオル、スリッパなど' },
                            { id: 6, name: 'その他サービス', icon: 'uil uil-question-circle', description: 'その他のサービス要求' }
                        ],
                        ko: [
                            { id: 1, name: '하우스키핑', icon: 'uil uil-cleaning-services', description: '객실 청소 서비스' },
                            { id: 2, name: '룸서비스', icon: 'uil uil-utensils', description: '객실 내 식사 서비스' },
                            { id: 3, name: '세탁 서비스', icon: 'uil uil-shirt', description: '의류 세탁 서비스' },
                            { id: 4, name: '시설 수리', icon: 'uil uil-wrench', description: '객실 시설 수리' },
                            { id: 5, name: '어메니티', icon: 'uil uil-box', description: '수건, 슬리퍼 등' },
                            { id: 6, name: '기타 서비스', icon: 'uil uil-question-circle', description: '기타 서비스 요청' }
                        ]
                    };
                    return services[this.currentLanguage] || services.zh;
                },

                changeLanguage() {
                    this.errorMessage = '';
                    console.log('语言切换到:', this.currentLanguage);
                },

                requestService(service) {
                    this.selectedService = service;
                    this.showServiceModal = true;
                    console.log('请求服务:', service.name);
                },

                confirmService() {
                    if (!this.selectedService) return;
                    
                    console.log('确认服务请求:', {
                        service: this.selectedService.name,
                        room: this.roomNumber,
                        note: this.serviceNote,
                        language: this.currentLanguage
                    });
                    
                    // 模拟API调用
                    setTimeout(() => {
                        alert(this.texts.serviceConfirmed);
                        this.showServiceModal = false;
                        this.selectedService = null;
                        this.serviceNote = '';
                    }, 500);
                },

                async handleVerify() {
                    this.loading = true;
                    this.errorMessage = '';

                    try {
                        // 模拟API调用: POST /api/verify {room, code}
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        
                        if (MOCK.validCodes.includes(this.verifyCode)) {
                            // 成功 - 存储JWT并跳转
                            localStorage.setItem('guest_sid', 'mock_jwt_token_' + Date.now());
                            console.log('验证成功，准备跳转到 /chat');
                            alert(this.texts.verifySuccess);
                            window.location.href = 'A-02-chat.html';
                        } else {
                            // 失败 - 显示错误
                            this.errorMessage = this.texts.verifyFailed;
                            this.verifyCode = '';
                        }
                    } catch (error) {
                        this.errorMessage = this.texts.networkError;
                    } finally {
                        this.loading = false;
                    }
                }
            };
        }
    </script>
</body>
</html> 